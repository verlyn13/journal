---
id: testing
title: Testing
type: testing
created: '2025-09-17T09:15:07.172916'
updated: '2025-09-17T09:15:07.172943'
author: documentation-system
tags:
- python
- javascript
- typescript
- react
- database
status: active
description: The Journal project maintains comprehensive test coverage across both
  backend (FastAPI) and frontend (React) applications. We enforce strict quality standards
  with automated testing, linting, and bund
---

# Journal Project Testing Documentation

## Overview

The Journal project maintains comprehensive test coverage across both backend (FastAPI) and frontend (React) applications. We enforce strict quality standards with automated testing, linting, and bundle size checks.

## Testing Philosophy

1. **Coverage First**: Minimum 85% code coverage requirement
2. **Test Categories**: Unit â†’ Integration â†’ E2E progression
3. **Fast Feedback**: Most tests run in under 20 seconds
4. **Deterministic**: Mocked external services, fixed test data
5. **Documentation**: Tests serve as living documentation

## Project Structure

```
journal/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ api/                    # Backend (FastAPI)
â”‚   â”‚   â”œâ”€â”€ tests/              # 136 pytest tests
â”‚   â”‚   â””â”€â”€ TESTING.md          # API testing documentation
â”‚   â”‚
â”‚   â””â”€â”€ web/                    # Frontend (React)
â”‚       â”œâ”€â”€ src/__tests__/      # Vitest tests
â”‚       â””â”€â”€ TESTING.md          # Web testing documentation
â”‚
â””â”€â”€ TESTING.md                  # This file (project overview)
```

## Quick Start

### Backend Testing (FastAPI)

```bash
cd apps/api

# Run all tests with coverage
make test

# Quick test run
uv run pytest

# Detailed coverage report
uv run pytest --cov=app --cov-report=term-missing
```

**Status**: 79% coverage (need 85%), 132/136 tests passing

### Frontend Testing (React)

```bash
cd apps/web

# Run all tests
bun test

# Run with watch mode
bun test --watch

# Complete quality suite (lint, types, tests, bundle)
bun run quality:all
```

**Status**: 7 tests passing, bundle size 1318KB (under 1500KB limit âœ…)

## Coverage Requirements

| Component    | Required | Current | Status               |
| ------------ | -------- | ------- | -------------------- |
| Backend API  | 85%      | 79%     | âš ï¸ Needs improvement |
| Frontend Web | 80%      | N/A     | ğŸš§ In progress       |
| E2E Tests    | N/A      | N/A     | ğŸ“ Planned           |

## Test Categories

### 1. Unit Tests

- **Purpose**: Test pure functions and business logic
- **Location**: `tests/unit/` (API), `src/utils/__tests__/` (Web)
- **Speed**: < 1 second
- **Dependencies**: None (all mocked)

### 2. Integration Tests

- **Purpose**: Test component interactions
- **Location**: `tests/integration/` (API), `src/__tests__/integration/` (Web)
- **Speed**: < 10 seconds
- **Dependencies**: Database, mocked external services

### 3. API Tests

- **Purpose**: Test HTTP endpoints
- **Location**: `tests/api/` (API only)
- **Speed**: < 5 seconds
- **Dependencies**: Test database, mocked auth

### 4. E2E Tests

- **Purpose**: Full user workflows
- **Location**: `tests/e2e/` (API), Playwright tests (Web)
- **Speed**: < 30 seconds
- **Dependencies**: Full stack running

## Phase 4 Testing Focus

The current Phase 4 (Dual-write Integration) includes specific test requirements:

### Backend (API)

- âœ… Dual-write saves both HTML and Markdown formats
- âœ… Content format negotiation via headers
- âœ… Backward compatibility maintained
- âœ… Migration script tested

### Frontend (Web)

- âœ… Markdown editor integration tested
- âœ… Dual-write on save verified
- âœ… Header negotiation confirmed
- âœ… Bundle size under limit

## CI/CD Integration

Tests run automatically on:

- Pull request creation/update
- Pushes to main branch
- Scheduled nightly runs
- Manual workflow dispatch

### GitHub Actions Workflow

```yaml
test:
  runs-on: ubuntu-latest
  steps:
  - uses: actions/checkout@v4
  - name: Backend Tests
      run: |
        cd apps/api
        uv sync
        uv run pytest --cov=app
  - name: Frontend Tests
      run: |
        cd apps/web
        bun install
        bun run quality:all
```

## Development Workflow

### Before Committing

1. **Run Tests**: Ensure all tests pass
2. **Check Coverage**: Verify coverage hasn't decreased
3. **Lint Code**: Run formatters and linters
4. **Type Check**: Ensure TypeScript/Python types are correct
5. **Bundle Check**: Verify bundle size (frontend only)

### Adding New Features

1. **Write Tests First**: TDD approach recommended
2. **Update Documentation**: Keep TESTING.md files current
3. **Maintain Coverage**: Don't let coverage drop below minimum
4. **Review Test Output**: Ensure tests are meaningful

## Common Commands

### Backend (FastAPI)

```bash
# Start test infrastructure
docker compose up -d db redis nats

# Run all tests
make test

# Run specific category
uv run pytest tests/api/
uv run pytest tests/integration/
uv run pytest tests/unit/

# Generate coverage report
uv run pytest --cov=app --cov-report=html
open htmlcov/index.html
```

### Frontend (React)

```bash
# Run tests
bun test

# Run in watch mode
bun test --watch

# Run with UI
bun test --ui

# Check everything
bun run quality:all
```

## Troubleshooting

### Backend Issues

1. **Database Connection Failed**
   ```bash
   docker compose up -d db
   ```

2. **Tests Not Found**
   ```bash
   rm -rf .pytest_cache
   uv run pytest --collect-only
   ```

3. **Coverage Not Updating**
   ```bash
   rm .coverage
   uv run pytest --cov=app --cov-report=term
   ```

### Frontend Issues

1. **Module Import Errors**
   ```bash
   rm -rf node_modules (managed by Bun)/.vite
   bun install
   ```

2. **Test Timeouts**

- Increase timeout in test: `{ timeout: 5000 }`
- Check for unresolved promises

3. **Bundle Size Exceeded**
   ```bash
   bun run build
   ls -lh dist/assets/*.js
   ```

## Best Practices

1. **Descriptive Names**: Test names should explain what they test
2. **Arrange-Act-Assert**: Clear test structure
3. **One Assertion**: Each test verifies one behavior
4. **Fast Tests**: Mock slow operations
5. **Deterministic**: No random data, fixed timestamps
6. **Isolated**: Tests don't affect each other
7. **Documented**: Complex tests need comments

## Resources

- [Backend Testing Guide](testing/TESTING.md)
- [Frontend Testing Guide](testing/TESTING.md)
- [Pytest Documentation](https://docs.pytest.org/)
- [Vitest Documentation](https://vitest.dev/)
- [Testing Library](https://testing-library.com/)

## Contact

For testing questions or improvements:

- Create an issue in the repository
- Tag with `testing` label
- Include test output and coverage reports

***

*Last Updated: September 2025*
*Minimum Coverage: 85% (Backend), 80% (Frontend)*
*Current Focus: Phase 4 - Dual-write Integration*
