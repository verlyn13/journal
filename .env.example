# Flask/Runtime
FLASK_ENV=development
LOG_LEVEL=DEBUG

# Observability toggles
LOG_SAMPLING=false
LOG_SAMPLE_INFO=0.1
LOG_SAMPLE_DEBUG=0.01
LOG_HTTP=false

# OpenTelemetry (OTLP/HTTP)
OTEL_ENABLED=false
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318
SERVICE_NAME=journal
SERVICE_VERSION=0.1.0

# ================================
# App basics
# ================================
APP_ENV=dev                  # dev | staging | prod
APP_HOST=0.0.0.0
APP_PORT=8080
LOG_LEVEL=INFO               # DEBUG|INFO|WARN|ERROR

# ================================
# Self-hosted Infisical (CLI & SDK)
# ================================
INFISICAL_API_URL=https://your-infisical.example.com/api
INFISICAL_PROJECT_ID=proj_xxxxxxxxxxxxxxxxxxxx

# Auth to Infisical (pick ONE flow per environment):
# 1) Service token (CI or quick start). Keep short-lived.
# INFISICAL_TOKEN=st.xxxxxx.yyyyyy.zzzzzz

# 2) Machine Identity (universal-auth) â€” preferred for CI/runtime
# INFISICAL_UNIVERSAL_AUTH_CLIENT_ID=mi_client_xxxxx
# INFISICAL_UNIVERSAL_AUTH_CLIENT_SECRET=mi_secret_xxxxx

# 3) Kubernetes native (pod uses SA token)
# INFISICAL_MACHINE_IDENTITY_ID=mi_xxxxxxxxx
# INFISICAL_KUBERNETES_SERVICE_ACCOUNT_TOKEN_PATH=/var/run/secrets/kubernetes.io/serviceaccount/token

# If your Infisical is behind Cloudflare Access (optional)
# INFISICAL_CUSTOM_HEADERS=Access-Client-Id=xxx Access-Client-Secret=yyy

# ================================
# Where your app expects injected secrets
# (infisical run --env=... --path=/auth ...)
# ================================
INFISICAL_RUNTIME_PATH=/auth

# The following are PROVIDED BY INFISICAL at runtime and shown here only
# to document expected keys (do not commit real values):
# AUTH_ENC_KEYS={"2025-10":"<base64url-256-bit-key>"}
# AUTH_ENC_ACTIVE_KID=2025-10
# JWT_PUBLIC_JWKS={"keys":[...]}        # public set your app publishes
# JWT_PRIVATE_CURRENT_PEM=-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----
# JWT_PRIVATE_NEXT_PEM=-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----
# OAUTH_<PROVIDER>_CLIENT_ID=xxx
# OAUTH_<PROVIDER>_CLIENT_SECRET=yyy

# ================================
# Token service (your app)
# ================================
TOKEN_ISSUER=https://auth.yourdomain.example.com
ACCESS_TOKEN_TTL_SECONDS=600            # 10 minutes
SESSION_IDLE_TTL_SECONDS=1800           # 30 minutes
SESSION_ABSOLUTE_TTL_SECONDS=43200      # 12 hours

# Cookie hardening
SESSION_COOKIE_NAME=sid
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=Lax             # Lax | Strict | None

# ================================
# WebAuthn / Passkeys
# ================================
WEBAUTHN_RP_ID=yourdomain.example.com   # EXACT domain (no scheme)
WEBAUTHN_RP_NAME=Your App
WEBAUTHN_ORIGIN=https://yourdomain.example.com
WEBAUTHN_REQUIRE_UV=true                # user verification Required

# ================================
# OAuth/OIDC (fallback/bring-your-own IdP)
# ================================
OIDC_ISSUER=https://idp.example.com
OIDC_CLIENT_ID=your_client_id
OIDC_CLIENT_SECRET=your_client_secret
OIDC_JWKS_URI=https://idp.example.com/.well-known/jwks.json
OIDC_USE_PAR=true                       # provider supports PAR
OIDC_USE_PKCE=true

# ================================
# Data stores
# ================================
DATABASE_URL=postgresql+psycopg://user:pass@localhost:5432/yourdb
REDIS_URL=redis://localhost:6379/0

# ================================
# Email (magic links / notifications)
# ================================
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USERNAME=postmaster@example.com
SMTP_PASSWORD=<password>
SMTP_FROM=Your App <no-reply@yourdomain.example.com>
SMTP_STARTTLS=true

# ================================
# Rate limiting & security toggles
# ================================
AUTH_RATE_LOGIN_ATTEMPTS=5
AUTH_RATE_LOGIN_WINDOW_SECONDS=300
AUTH_RATE_TOTP_ATTEMPTS=5
AUTH_RATE_TOTP_WINDOW_SECONDS=300

# ================================
# Operational flags (safe defaults)
# ================================
INFISICAL_DISABLE_UPDATE_CHECK=true      # faster CI runs

