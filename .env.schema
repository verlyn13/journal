# Environment Variables Schema
# Source of Truth for Journal Application
# Last Updated: 2025-09-16
#
# Format: VAR_NAME=example_value # [SCOPE] Description
# Scopes: FE (Frontend), BE (Backend), DB (Database), SHARED

# ============================================================================
# FRONTEND VARIABLES (FE)
# ============================================================================

# API Configuration
VITE_API_URL=http://localhost:5000 # [FE] Backend API base URL
VITE_WS_URL=ws://localhost:5000 # [FE] WebSocket endpoint (if needed)

# Supabase Configuration
VITE_SUPABASE_URL=http://localhost:54321 # [FE] Supabase project URL
VITE_SUPABASE_ANON_KEY=local-anon-key # [FE] Public anonymous key
NEXT_PUBLIC_SUPABASE_URL=https://[project-ref].supabase.co # [FE] Production/preview Supabase URL
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key # [FE] Production/preview anonymous key

# Feature Flags
VITE_ENABLE_AUTH=false # [FE] Enable authentication features
VITE_ENABLE_ANALYTICS=false # [FE] Enable analytics tracking
VITE_ENABLE_SEARCH=true # [FE] Enable search functionality
VITE_DEBUG_MODE=false # [FE] Enable debug logging

# ============================================================================
# BACKEND VARIABLES (BE)
# ============================================================================

# Server Configuration
PORT=5000 # [BE] Server port
HOST=0.0.0.0 # [BE] Bind host
WORKERS=4 # [BE] Number of Uvicorn workers
LOG_LEVEL=info # [BE] Logging level (debug/info/warning/error)

# CORS Configuration
CORS_ORIGINS=http://localhost:5173,http://localhost:3000 # [BE] Allowed origins

# Environment
JOURNAL_ENV=development # [BE] Environment name (development/staging/production)
NODE_ENV=development # [SHARED] Node environment

# ============================================================================
# DATABASE VARIABLES (DB)
# ============================================================================

# Local Development Database
DATABASE_URL=postgresql://journal:journal@localhost:5433/journal # [DB] Local primary connection
JOURNAL_DB_URL_ASYNC=postgresql+asyncpg://journal:journal@localhost:5433/journal # [DB] Local async SQLAlchemy
JOURNAL_DB_URL_SYNC=postgresql+psycopg://journal:journal@localhost:5433/journal # [DB] Local sync operations

# Supabase Database (Production/Preview)
SUPABASE_DB_URL=postgresql://postgres:[password]@db.[project-ref].supabase.co:5432/postgres # [DB] Supabase direct connection
SUPABASE_DB_URL_POOLED=postgresql://postgres:[password]@db.[project-ref].supabase.co:6543/postgres?pgbouncer=true # [DB] Supabase pooled (serverless)
SUPABASE_PROJECT_REF=your-project-ref # [DB] Supabase project reference ID

# Connection Pool Configuration
DATABASE_POOL_SIZE=5 # [DB] Conservative pool size for Supabase
DATABASE_MAX_OVERFLOW=10 # [DB] Max overflow connections
DATABASE_POOL_TIMEOUT=30 # [DB] Pool timeout in seconds
DATABASE_POOL_RECYCLE=3600 # [DB] Connection recycle time (1 hour)

# Supabase-specific Connection Settings
DATABASE_PREPARED_STATEMENT_CACHE_SIZE=0 # [DB] Disable prepared statements for pooled connections
DATABASE_STATEMENT_TIMEOUT=30000 # [DB] Statement timeout in milliseconds
DATABASE_IDLE_IN_TRANSACTION_SESSION_TIMEOUT=300000 # [DB] Idle transaction timeout (5 min)

# SSL Configuration (Required for Supabase)
PGSSLMODE=require # [DB] SSL mode for cloud connections
PGSSLCERT= # [DB] Client certificate path (if needed)
PGSSLKEY= # [DB] Client key path (if needed)
PGSSLROOTCERT= # [DB] Root certificate path (if needed)

# ============================================================================
# CACHE & QUEUE VARIABLES
# ============================================================================

# Redis
REDIS_URL=redis://localhost:6380/0 # [BE] Redis connection URL
REDIS_MAX_CONNECTIONS=50 # [BE] Maximum connections
REDIS_DECODE_RESPONSES=true # [BE] Auto-decode strings

# NATS
NATS_URL=nats://localhost:4222 # [BE] NATS server URL
NATS_USER=journal # [BE] NATS username (if auth enabled)
NATS_PASSWORD= # [BE] NATS password (if auth enabled)
NATS_CLUSTER_ID=journal-cluster # [BE] Cluster identifier

# ============================================================================
# AUTHENTICATION & SECURITY (BE)
# ============================================================================

# JWT Configuration
JOURNAL_JWT_SECRET=change_me_32_char_random_string_here # [BE] JWT signing key
JOURNAL_JWT_ISS=journal-api # [BE] JWT issuer
JOURNAL_JWT_AUD=journal-clients # [BE] JWT audience
JOURNAL_ACCESS_TOKEN_MINUTES=15 # [BE] Access token TTL
JOURNAL_REFRESH_TOKEN_DAYS=30 # [BE] Refresh token TTL

# WebAuthn
JOURNAL_WEBAUTHN_RP_ID=localhost # [BE] Relying party ID
JOURNAL_WEBAUTHN_RP_NAME=Journal App # [BE] Display name
JOURNAL_WEBAUTHN_ORIGIN=http://localhost:3000 # [BE] Expected origin

# Rate Limiting
JOURNAL_RATE_LIMIT_WINDOW_SECONDS=60 # [BE] Rate limit window
JOURNAL_RATE_LIMIT_MAX_ATTEMPTS=5 # [BE] Max attempts in window

# ============================================================================
# EXTERNAL SERVICES
# ============================================================================

# Supabase (Backend) - 2025 Patterns
SUPABASE_PROJECT_URL=https://[project-ref].supabase.co # [BE] Project URL (same as NEXT_PUBLIC_)
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key # [BE] Service role key (NEVER expose to frontend)
SUPABASE_JWT_SECRET=your-jwt-secret # [BE] JWT secret for token verification
SUPABASE_ANON_KEY=your-anon-key # [BE] Public anonymous key (shared with frontend)

# Infisical (Optional)
INFISICAL_ENABLED=false # [BE] Enable Infisical integration
INFISICAL_PROJECT_ID= # [BE] Infisical project ID
INFISICAL_SERVER_URL=https://secrets.jefahnierocks.com # [BE] Infisical server
INFISICAL_CACHE_TTL=300 # [BE] Cache TTL in seconds

# OpenTelemetry (Optional)
OTLP_ENDPOINT=http://localhost:4317 # [BE] OTLP endpoint
OTEL_SERVICE_NAME=journal-api # [BE] Service name for tracing

# ============================================================================
# BUILD & DEPLOYMENT
# ============================================================================

# Vercel System (Auto-injected)
VERCEL= # [SHARED] Set to 1 in Vercel environment
VERCEL_ENV= # [SHARED] development/preview/production
VERCEL_URL= # [SHARED] Deployment URL
VERCEL_GIT_COMMIT_SHA= # [SHARED] Git commit hash
VERCEL_GIT_COMMIT_MESSAGE= # [SHARED] Commit message

# CI/CD
CI=true # [SHARED] Indicates CI environment
GITHUB_ACTIONS= # [SHARED] Set in GitHub Actions

# ============================================================================
# VALIDATION RULES
# ============================================================================
#
# Required for Frontend:
#   - VITE_API_URL
#   - NEXT_PUBLIC_SUPABASE_URL (or VITE_SUPABASE_URL for local)
#   - NEXT_PUBLIC_SUPABASE_ANON_KEY (or VITE_SUPABASE_ANON_KEY for local)
#
# Required for Backend:
#   - SUPABASE_DB_URL (production) or DATABASE_URL (local)
#   - SUPABASE_SERVICE_ROLE_KEY (production)
#   - JOURNAL_JWT_SECRET
#   - PORT
#
# Required for Production:
#   - All JOURNAL_JWT_* variables
#   - SUPABASE_PROJECT_URL, SUPABASE_SERVICE_ROLE_KEY
#   - SUPABASE_DB_URL with SSL (PGSSLMODE=require)
#   - CORS_ORIGINS (must not include localhost)
#   - LOG_LEVEL (should be 'info' or higher)
#   - NODE_ENV=production
#   - JOURNAL_ENV=production
#
# Security Rules:
#   - NEVER expose SUPABASE_SERVICE_ROLE_KEY to frontend
#   - Use SUPABASE_ANON_KEY for frontend (limited permissions)
#   - JWT_SECRET must be at least 32 characters
#   - Different secrets per environment (dev/preview/prod)
#   - No localhost URLs in production
#   - SSL required for Supabase connections (PGSSLMODE=require)
#   - Conservative connection pooling (DATABASE_POOL_SIZE=5)
#
# ============================================================================